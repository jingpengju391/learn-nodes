# 从输入URL到页面加载发生了什么

### 空间维度

- 客户端
- 网络
- 服务器

### 时间维度

- 输入url

  - 回车前：输入第一个字符开始，浏览器会检索历史记录，显示匹配的地址。
  - 回车后：浏览器会通过正则去判断地址栏的内容是URL或搜索内容。如果是URL（如果缺少协议会自动拼接）根据URL进行访问，如果是搜索内容会根据默认的搜索引擎拼接URL跳转。

- 网络数据

  - 浏览器通过进程通信（IPC）把URL发送到网络进程中，网络进程发起真正的URL请求。

  - 发请求前网络进程请求的URL判断是否缓存了该资源，如果有则把该资源返回给浏览器进程，否则进行DNS解析。

    ~~~
    浏览器进程：浏览器本身的进程一共有四个。
    	1.浏览器的主进程
    		负责浏览器的界面显示、用户交互。
    	  负责页面的管理，创建销毁其他的进程
    		负责绘制界面
    	  网络资源的管理下载等
    	2.浏览器的渲染进程
    		核心工作是将HTML/CSS/JS转化为用户可交互的界面。
    	3.GPU进程
    		用于3D绘制，最多一个
    	4.第三方插件进程
    		每个插件会有一个自己的进程，仅当该插件应用的时候才会开启对应进程
    	
    网络进程：网络中主进程的一个索引
    DNS解析：
    	定义：Domain Name System的缩写，中文域名系统。
    	结构：四级域名、三级域名、二级域名、顶级域名，特殊提下顶级域名由ICANN进行管理。
    	解析过程：一般采用递归的方式进行查询。
    		1. 查看浏览器缓存：浏览器在自己的缓存中查找是否有该域名对应的ip地址。
    		2. 如果浏览器缓存中无该域名对应的ip地址，则会自动检查计算机系统hosts文件的DNS缓存是否存在该域名对应的IP
    		3. 当浏览器和计算机文件系统中均无该域名对应的IP地址则会进入路由器进行检查
    		4. 当用户的客户端无法查到该域名对应的ip地址，则将进入ISP DNS缓存中查询。比如电信网络就进入电信网络DNS缓存服务器进行查询
    		5. 当以上均为完成，则进入根域名服务器查询。全球仅有13台根域名服务器，1个主根域名服务器，其余12个为辅根域名服务器，根域名收到请求后会会产看文件缓存记录，如无会将该区域的顶级域名(com/.cn)服务器的IP返给本地DNS服务器
    		6.顶级域名服务器收到请求后产看文件记录，如无记录则将管辖区域的权威域名服务器的IP地址告诉本地DNS服务器
    		7.权威域名服务器接收到请求后查询自己的缓存，如果没有则进行下一级域名服务器进行查询，并重复该步骤知道正确记录
    		8.本地域名服务器把返回的结果保存到缓存，以备下一次使用，同时把该结果返回给客户端，客户端通过这个IP地址既可以访问目标web服务器。
    		
    	总结：DNS解析承担着将域名解析成IP地址的重要作用，是计算机之间实现访问互联网的关键和基础。
    ~~~

  - 接下来通过IP地址和服务器建立TCP链接（三次握手），链接成功后，浏览器后构造请求行、请求头、向服务器发送构建后的请求信息

    ```
    TCP链接：
    ```

  - 服务器会根据请求内容进行返回，如果是静态网站，一般交给nginx做反向代理，根据请求的域名做location到服务器的某个静态文件上。如果是动态会有controller处理返回页面

  - 返回数据后就回关闭TCP链接，可以通过家请求头的方式维持TCP的开启状态（Connection:Keep-Alive）

- 浏览器解析、排版、渲染和绘制

  